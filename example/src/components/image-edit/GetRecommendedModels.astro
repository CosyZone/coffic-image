---
// 这个组件用于查询推荐的图像编辑模型
import { Button, Container } from "@coffic/cosy-ui";
---

<Container ignore-heading>
  <Button id="getRecommendedModels">查询推荐模型</Button>
  <Container id="recommendedModelsResult" />
</Container>

<script>
  import { actions } from 'astro:actions';

  // 定义类型
  interface ImageEditModel {
    name: string;
    description: string;
    capabilities: string[];
    recommended: boolean;
  }

  interface ApiResult {
    success: boolean;
    message: string;
    data: {
      models: ImageEditModel[];
      total: number;
      formattedText: string;
    };
    error?: string;
  }

  document
    .getElementById('getRecommendedModels')
    ?.addEventListener('click', async () => {
      const resultArea = document.getElementById('recommendedModelsResult');
      if (!resultArea) return;

      resultArea.innerHTML = '<p>查询中...</p>';

      try {
        const { data, error } = await actions.getImageEditModels({
          includeRecommended: true,
        });

        if (error) {
          resultArea.innerHTML = `<div class="error-result">查询失败: ${error.message}</div>`;
          return;
        }

        if (data) {
          const result = data as ApiResult;
          const models = result.data.models || [];
          const modelsHtml = models
            .map(
              (model: ImageEditModel) => `
          <div class="model-item">
            <h4>⭐ ${model.name}</h4>
            <p><strong>描述:</strong> ${model.description}</p>
            <p><strong>能力:</strong> ${model.capabilities.join(', ')}</p>
          </div>
        `
            )
            .join('');

          resultArea.innerHTML = `
          <div class="success-result">
            <h4>查询成功 (共${result.data.total || 0}个推荐模型)</h4>
            ${modelsHtml}
          </div>
        `;
        }
      } catch (error) {
        const errorMessage =
          error instanceof Error ? error.message : '未知错误';
        resultArea.innerHTML = `<div class="error-result">查询出错: ${errorMessage}</div>`;
      }
    });
</script>

<style>
  .success-result {
    background-color: #d4edda;
    border: 1px solid #c3e6cb;
    color: #155724;
  }

  .error-result {
    background-color: #f8d7da;
    border: 1px solid #f5c6cb;
    color: #721c24;
  }

  .model-item {
    background-color: white;
    padding: 15px;
    margin: 10px 0;
    border-radius: 5px;
    border-left: 4px solid #007bff;
  }

  .model-item h4 {
    margin-top: 0;
    color: #2c3e50;
  }
</style>
